version: '3'
# this can be then plugged to a larger yml while where you want all the services to work in a swarm
# here we are just making a file for a single service to run
services:
  srvauth:
    build: 
      context: .
      dockerfile: Dockerfile
      args: 
        - SRC=${REPODIR}
        - BIN=${BINDIR}
    volumes:
      # - ${GOBINDIR}:${GOBINDIR}
      - $GOPATH/pkg/mod:$GOPATH/pkg/mod
      - /sys:/sys
      - ${TIMEZ}:${TIMEZ}
      - ${LCLTM}:${LCLTM}
      # map these 2 directories on the host machine
      - ${SOCKSDIR}:${SOCKSDIR}
      - ${LOGDIR}:${LOGDIR}
    environment:
      - LOGF=${LOGDIR}/srvauth.log
      - AUTHBASEURL=${AUTHBASEURL}
      - REGBASEURL=${REGBASEURL}
      - HALTSOCK=${SOCKSDIR}/halt.sock
      - USER=${OWNER}
      - RLYS=${RELAYS}
    tty: ${TTYSTDIN}
    stdin_open: ${TTYSTDIN}
    container_name: ctn_srvauth
    # command: ["tail", "-f", "/dev/null"]
    command: ["${BINDIR}/srvauth","-flog=${FLOG}", "-verbose=${VERBOSE}"]